<nav class="navbar">
  <!-- If admin => show icons -->
  <div class="navbar-menu-toggle" *ngIf="isAdmin">
    <span class="hamburger-icon" (click)="toggleSidebar()">&#9776;</span>
    <span class="trash-icon" (click)="navigateToBin()">
      <svg version="1.1" id="Layer_1" x="0px" y="0px" width="15px" height="20px" viewBox="0 0 108.294 122.88" enable-background="new 0 0 108.294 122.88" xml:space="preserve"><g><path class="bin-icon" d="M4.873,9.058h33.35V6.2V6.187c0-0.095,0.002-0.186,0.014-0.279c0.075-1.592,0.762-3.037,1.816-4.086l-0.007-0.007 c1.104-1.104,2.637-1.79,4.325-1.806l0.023,0.002V0h0.031h19.884h0.016c0.106,0,0.207,0.009,0.309,0.022 c1.583,0.084,3.019,0.76,4.064,1.81c1.102,1.104,1.786,2.635,1.803,4.315l-0.003,0.021h0.014V6.2v2.857h32.909h0.017 c0.138,0,0.268,0.014,0.401,0.034c1.182,0.106,2.254,0.625,3.034,1.41l0.004,0.007l0.005-0.007 c0.851,0.857,1.386,2.048,1.401,3.368l-0.002,0.032h0.014v0.032v10.829c0,1.472-1.195,2.665-2.667,2.665h-0.07H2.667 C1.195,27.426,0,26.233,0,24.762v-0.063V13.933v-0.014c0-0.106,0.004-0.211,0.018-0.315v-0.021 c0.089-1.207,0.624-2.304,1.422-3.098l-0.007-0.002C2.295,9.622,3.49,9.087,4.81,9.069l0.032,0.002V9.058H4.873L4.873,9.058z M77.79,49.097h-5.945v56.093h5.945V49.097L77.79,49.097z M58.46,49.097h-5.948v56.093h5.948V49.097L58.46,49.097z M39.13,49.097 h-5.946v56.093h5.946V49.097L39.13,49.097z M10.837,31.569h87.385l0.279,0.018l0.127,0.007l0.134,0.011h0.009l0.163,0.023 c1.363,0.163,2.638,0.789,3.572,1.708c1.04,1.025,1.705,2.415,1.705,3.964c0,0.098-0.009,0.193-0.019,0.286l-0.002,0.068 l-0.014,0.154l-7.393,79.335l-0.007,0.043h0.007l-0.016,0.139l-0.051,0.283l-0.002,0.005l-0.002,0.018 c-0.055,0.331-0.12,0.646-0.209,0.928l-0.007,0.022l-0.002,0.005l-0.009,0.018l-0.023,0.062l-0.004,0.021 c-0.118,0.354-0.264,0.698-0.432,1.009c-1.009,1.88-2.879,3.187-5.204,3.187H18.13l-0.247-0.014v0.003l-0.011-0.003l-0.032-0.004 c-0.46-0.023-0.889-0.091-1.288-0.202c-0.415-0.116-0.818-0.286-1.197-0.495l-0.009-0.002l-0.002,0.002 c-1.785-0.977-2.975-2.882-3.17-5.022L4.88,37.79l-0.011-0.125l-0.011-0.247l-0.004-0.116H4.849c0-1.553,0.664-2.946,1.707-3.971 c0.976-0.955,2.32-1.599,3.756-1.726l0.122-0.004v-0.007l0.3-0.013l0.104,0.002V31.569L10.837,31.569z M98.223,36.903H10.837 v-0.007l-0.116,0.004c-0.163,0.022-0.322,0.106-0.438,0.222c-0.063,0.063-0.104,0.132-0.104,0.179h-0.007l0.007,0.118l7.282,79.244 h-0.002l0.002,0.012c0.032,0.376,0.202,0.691,0.447,0.825l-0.002,0.004l0.084,0.032l0.063,0.012h0.077h72.695 c0.207,0,0.399-0.157,0.518-0.377l0.084-0.197l0.054-0.216l0.014-0.138h0.005l7.384-79.21L98.881,37.3 c0-0.045-0.041-0.111-0.103-0.172c-0.12-0.118-0.286-0.202-0.451-0.227L98.223,36.903L98.223,36.903z M98.334,36.901h-0.016H98.334 L98.334,36.901z M98.883,37.413v-0.004V37.413L98.883,37.413z M104.18,37.79l-0.002,0.018L104.18,37.79L104.18,37.79z M40.887,14.389H5.332v7.706h97.63v-7.706H67.907h-0.063c-1.472,0-2.664-1.192-2.664-2.664V6.2V6.168h0.007 c-0.007-0.22-0.106-0.433-0.259-0.585c-0.137-0.141-0.324-0.229-0.521-0.252h-0.082h-0.016H44.425h-0.031V5.325 c-0.213,0.007-0.422,0.104-0.576,0.259l-0.004-0.004l-0.007,0.004c-0.131,0.134-0.231,0.313-0.259,0.501l0.007,0.102V6.2v5.524 C43.554,13.196,42.359,14.389,40.887,14.389L40.887,14.389z"/></g></svg>
    </span>
  </div>


  <!-- If user => show cogwheel -->
  <div class="navbar-menu-toggle" *ngIf="!isAdmin" (click)="openUserSettings()">
    <!-- Simple gear icon; you can replace with an SVG if you prefer -->
    <span class="cog-icon">&#9881;</span>
  </div>

  <div class="navbar-title">Zeitausgleich</div>
  <div class="navbar-actions">
    <button class="timesheet-button" [routerLink]="['/monthly-overview']" *ngIf="!isAdmin">
      Monat
    </button>
    <button class="logout-button" (click)="logout()">Abmelden</button>
  </div>
</nav>


<div class="container">
  <div class="content-wrapper">
    <aside class="sidebar" [class.sidebar-open]="isSidebarOpen">
      <div class="sidebar-search">
        <input
          type="text"
          class="search-bar"
          placeholder="Mitarbeiter suchen..."
          (input)="searchEmployee($event)"
        />
      </div>
      <div class="sidebar-header">
        <h2 class="sidebar-header-h2">Mitarbeiter</h2>
        <span
          *ngIf="isAdmin"
          class="add-icon"
          (click)="navigateToAddMitarbeiter()"
        >
          <svg version="1.1" id="Layer_1" x="0px" y="0px" width="20px" height="20px" viewBox="0 0 122.881 122.88" enable-background="new 0 0 122.881 122.88" xml:space="preserve"><g><path class="add-icon" d="M56.573,4.868c0-0.655,0.132-1.283,0.37-1.859c0.249-0.6,0.61-1.137,1.056-1.583C58.879,0.545,60.097,0,61.44,0 c0.658,0,1.287,0.132,1.863,0.371c0.012,0.005,0.023,0.011,0.037,0.017c0.584,0.248,1.107,0.603,1.543,1.039 c0.881,0.88,1.426,2.098,1.426,3.442c0,0.03-0.002,0.06-0.006,0.089v51.62l51.619,0c0.029-0.003,0.061-0.006,0.09-0.006 c0.656,0,1.285,0.132,1.861,0.371c0.014,0.005,0.025,0.011,0.037,0.017c0.584,0.248,1.107,0.603,1.543,1.039 c0.881,0.88,1.428,2.098,1.428,3.441c0,0.654-0.133,1.283-0.371,1.859c-0.248,0.6-0.609,1.137-1.057,1.583 c-0.445,0.445-0.98,0.806-1.58,1.055v0.001c-0.576,0.238-1.205,0.37-1.861,0.37c-0.029,0-0.061-0.002-0.09-0.006l-51.619,0.001 v51.619c0.004,0.029,0.006,0.06,0.006,0.09c0,0.656-0.133,1.286-0.371,1.861c-0.006,0.014-0.012,0.025-0.018,0.037 c-0.248,0.584-0.602,1.107-1.037,1.543c-0.883,0.882-2.1,1.427-3.443,1.427c-0.654,0-1.283-0.132-1.859-0.371 c-0.6-0.248-1.137-0.609-1.583-1.056c-0.445-0.444-0.806-0.98-1.055-1.58h-0.001c-0.239-0.575-0.371-1.205-0.371-1.861 c0-0.03,0.002-0.061,0.006-0.09V66.303H4.958c-0.029,0.004-0.059,0.006-0.09,0.006c-0.654,0-1.283-0.132-1.859-0.371 c-0.6-0.248-1.137-0.609-1.583-1.056c-0.445-0.445-0.806-0.98-1.055-1.58H0.371C0.132,62.726,0,62.097,0,61.44 c0-0.655,0.132-1.283,0.371-1.859c0.249-0.6,0.61-1.137,1.056-1.583c0.881-0.881,2.098-1.426,3.442-1.426 c0.031,0,0.061,0.002,0.09,0.006l51.62,0l0-51.62C56.575,4.928,56.573,4.898,56.573,4.868L56.573,4.868z"/></g></svg>
        </span>
      </div>

      <ul class="user-list">
        <li
          *ngFor="let employee of view_employees"
          [class.no-results]="employee.id === -1"
          (click)="employee.id !== -1 && onEmployeeClick(employee.id)"
          [class.active]="employee.id === selectedEmployeeId"
        >
          <span class="user-name">
            {{ (employee.firstname || 'No firstname') + ' ' + (employee.lastname || 'No lastname') }}
          </span>

          <span *ngIf="isAdmin && isSidebarOpen && employee.id !== -1" class="icon-group">
              <span class="report-icon" (click)="generateReport(employee)">
                <!-- Example "download" icon; feel free to replace with any SVG you like -->
                <svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                  <path d="M.5 9.9a.5.5 0 0 1 .5.5V12a2 2 0 0 0 2
                   2h10a2 2 0 0 0 2-2V10.4a.5.5 0 0 1 1 0V12a3
                   3 0 0 1-3 3H3a3 3 0 0 1-3-3V10.4a.5.5 0 0
                   1 .5-.5zM7.646 10.854a.5.5 0 0 0 .708
                   0l3-3a.5.5 0 1 0-.708-.708L8.5
                   9.293V1.5a.5.5 0 0 0-1 0v7.793L5.354
                   7.146a.5.5 0 1 0-.708.708l3 3z"/>
                </svg>
              </span>

              <span class="delete-icon" (click)="deleteEmployee(employee.id, $event)">
                <svg version="1.1" id="Layer_1" x="0px" y="0px" width="15px" height="20px" viewBox="0 0 108.294 122.88" enable-background="new 0 0 108.294 122.88" xml:space="preserve"><g><path class="delete-icon" d="M4.873,9.058h33.35V6.2V6.187c0-0.095,0.002-0.186,0.014-0.279c0.075-1.592,0.762-3.037,1.816-4.086l-0.007-0.007 c1.104-1.104,2.637-1.79,4.325-1.806l0.023,0.002V0h0.031h19.884h0.016c0.106,0,0.207,0.009,0.309,0.022 c1.583,0.084,3.019,0.76,4.064,1.81c1.102,1.104,1.786,2.635,1.803,4.315l-0.003,0.021h0.014V6.2v2.857h32.909h0.017 c0.138,0,0.268,0.014,0.401,0.034c1.182,0.106,2.254,0.625,3.034,1.41l0.004,0.007l0.005-0.007 c0.851,0.857,1.386,2.048,1.401,3.368l-0.002,0.032h0.014v0.032v10.829c0,1.472-1.195,2.665-2.667,2.665h-0.07H2.667 C1.195,27.426,0,26.233,0,24.762v-0.063V13.933v-0.014c0-0.106,0.004-0.211,0.018-0.315v-0.021 c0.089-1.207,0.624-2.304,1.422-3.098l-0.007-0.002C2.295,9.622,3.49,9.087,4.81,9.069l0.032,0.002V9.058H4.873L4.873,9.058z M77.79,49.097h-5.945v56.093h5.945V49.097L77.79,49.097z M58.46,49.097h-5.948v56.093h5.948V49.097L58.46,49.097z M39.13,49.097 h-5.946v56.093h5.946V49.097L39.13,49.097z M10.837,31.569h87.385l0.279,0.018l0.127,0.007l0.134,0.011h0.009l0.163,0.023 c1.363,0.163,2.638,0.789,3.572,1.708c1.04,1.025,1.705,2.415,1.705,3.964c0,0.098-0.009,0.193-0.019,0.286l-0.002,0.068 l-0.014,0.154l-7.393,79.335l-0.007,0.043h0.007l-0.016,0.139l-0.051,0.283l-0.002,0.005l-0.002,0.018 c-0.055,0.331-0.12,0.646-0.209,0.928l-0.007,0.022l-0.002,0.005l-0.009,0.018l-0.023,0.062l-0.004,0.021 c-0.118,0.354-0.264,0.698-0.432,1.009c-1.009,1.88-2.879,3.187-5.204,3.187H18.13l-0.247-0.014v0.003l-0.011-0.003l-0.032-0.004 c-0.46-0.023-0.889-0.091-1.288-0.202c-0.415-0.116-0.818-0.286-1.197-0.495l-0.009-0.002l-0.002,0.002 c-1.785-0.977-2.975-2.882-3.17-5.022L4.88,37.79l-0.011-0.125l-0.011-0.247l-0.004-0.116H4.849c0-1.553,0.664-2.946,1.707-3.971 c0.976-0.955,2.32-1.599,3.756-1.726l0.122-0.004v-0.007l0.3-0.013l0.104,0.002V31.569L10.837,31.569z M98.223,36.903H10.837 v-0.007l-0.116,0.004c-0.163,0.022-0.322,0.106-0.438,0.222c-0.063,0.063-0.104,0.132-0.104,0.179h-0.007l0.007,0.118l7.282,79.244 h-0.002l0.002,0.012c0.032,0.376,0.202,0.691,0.447,0.825l-0.002,0.004l0.084,0.032l0.063,0.012h0.077h72.695 c0.207,0,0.399-0.157,0.518-0.377l0.084-0.197l0.054-0.216l0.014-0.138h0.005l7.384-79.21L98.881,37.3 c0-0.045-0.041-0.111-0.103-0.172c-0.12-0.118-0.286-0.202-0.451-0.227L98.223,36.903L98.223,36.903z M98.334,36.901h-0.016H98.334 L98.334,36.901z M98.883,37.413v-0.004V37.413L98.883,37.413z M104.18,37.79l-0.002,0.018L104.18,37.79L104.18,37.79z M40.887,14.389H5.332v7.706h97.63v-7.706H67.907h-0.063c-1.472,0-2.664-1.192-2.664-2.664V6.2V6.168h0.007 c-0.007-0.22-0.106-0.433-0.259-0.585c-0.137-0.141-0.324-0.229-0.521-0.252h-0.082h-0.016H44.425h-0.031V5.325 c-0.213,0.007-0.422,0.104-0.576,0.259l-0.004-0.004l-0.007,0.004c-0.131,0.134-0.231,0.313-0.259,0.501l0.007,0.102V6.2v5.524 C43.554,13.196,42.359,14.389,40.887,14.389L40.887,14.389z"/></g></svg>
              </span>
          </span>
        </li>

      </ul>
    </aside>

    <main class="content">
      <div class="welcome">
        <h1 class="welcome-title">
          Willkommen, {{userService.user.firstname}}!
        </h1>
      </div>
      <section *ngIf="isAdmin" class="admin-dashboard">
        <h2 class="manager-dashboard">Manager Dashboard</h2>

        <div class="dashboard-summary">
          <div class="dashboard-card">
            <div class="card-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 12C14.21 12 16 10.21 16 8C16 5.79 14.21 4 12 4C9.79 4 8 5.79 8 8C8 10.21 9.79 12 12 12ZM12 14C9.33 14 4 15.34 4 18V20H20V18C20 15.34 14.67 14 12 14Z" fill="#A7D46C"/>
              </svg>
            </div>
            <div class="card-content">
              <h3>Total Employees</h3>
              <p class="card-value">{{employeeCount}}</p>
            </div>
          </div>

          <div class="dashboard-card">
            <div class="card-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M11.99 2C6.47 2 2 6.48 2 12C2 17.52 6.47 22 11.99 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 11.99 2ZM12 20C7.58 20 4 16.42 4 12C4 7.58 7.58 4 12 4C16.42 4 20 7.58 20 12C20 16.42 16.42 20 12 20ZM12.5 7H11V13L16.25 16.15L17 14.92L12.5 12.25V7Z" fill="#A7D46C"/>
              </svg>
            </div>
            <div class="card-content">
              <h3>Active Shifts</h3>
              <p class="card-value">{{activeShiftsCount}}</p>
            </div>
          </div>

          <div class="dashboard-card">
            <div class="card-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7v-5z" fill="#A7D46C"/>
              </svg>
            </div>
            <div class="card-content">
              <h3>Total Hours This Month</h3>
              <p class="card-value">{{monthlyHours}}</p>
            </div>
          </div>
        </div>

        <p class="dashboard-p">Hier können Sie die Arbeitszeiten der Mitarbeiter verwalten und Berichte generieren. <br> Graphen, Skizzen, alles kommt hier rein</p>
      </section>

      <section *ngIf="!isAdmin" class="employee-shifts">
        <div class="date-navigation">
          <button class="nav-button nav-left" (click)="changeDate(-1)">←</button>
          <div class="date-selector">
            <h2>{{ displayDate }}</h2>
            <button class="calendar-button" (click)="picker.open()">
              <mat-icon>calendar_today</mat-icon>
            </button>
            <input
              [matDatepicker]="picker"
              (dateChange)="onDateSelected($event.value)"
              style="display: none">
            <mat-datepicker
              #picker
              [startAt]="currentDate">
            </mat-datepicker>
          </div>
          <button class="nav-button nav-right" (click)="changeDate(1)">→</button>
        </div>

        <div *ngIf="displayDate === 'Heute'">
          <div class="shift-actions">
            <button class="shift-button"
                    [disabled]="activeShiftStart !== null"
                    [class.disabled]="activeShiftStart !== null"
                    (click)="startShift()">
              Schicht beginnen
            </button>
            <button class="shift-button"
                    [disabled]="!activeShiftStart || activeShiftEnd !== null || isOnBreak"
                    [class.disabled]="!activeShiftStart || activeShiftEnd !== null || isOnBreak"
                    (click)="endShift()">
              Schicht beenden
            </button>
            <button class="shift-button"
                    [disabled]="!activeShiftStart || activeShiftEnd !== null || isOnBreak"
                    [class.disabled]="!activeShiftStart || activeShiftEnd !== null || isOnBreak"
                    (click)="startBreak()">
              Pause beginnen
            </button>
            <button class="shift-button"
                    [disabled]="!isOnBreak || activeShiftEnd !== null"
                    [class.disabled]="!isOnBreak || activeShiftEnd !== null"
                    (click)="endBreak()">
              Pause beenden
            </button>
          </div>
        </div>

        <div class="shift-status">
          <div class="shift-container" *ngIf="activeShiftStart">
            <div class="shift-timeline"
                 [class.with-start-dot]="activeShiftStart && activeShiftEnd"
                 [class.with-end-dot]="activeShiftEnd">
            </div>

            <div class="times-container">
              <p class="shift-start" *ngIf="activeShiftStart">
                Schicht begonnen um: {{ activeShiftStart }}
              </p>

              <ng-container *ngFor="let break of breaks">
                <div class="break-container">
                  <div class="break-info">
                    <p>Pause begonnen um: {{ break.breakStart | date:'HH:mm:ss' }}</p>
                    <p *ngIf="break.breakEnd">Pause beendet um: {{ break.breakEnd | date:'HH:mm:ss' }}</p>
                  </div>
                </div>
              </ng-container>

              <p class="shift-end" *ngIf="activeShiftEnd">
                Schicht beendet um: {{ activeShiftEnd }}
              </p>
            </div>
          </div>

          <div *ngIf="!activeShiftStart" class="no-shift-message">
            <p>An diesem Tag sind keine aktiven Schichten verfügbar.</p>
          </div>
        </div>
      </section>

      <section *ngIf="selectedEmployeeId" class="employee-shifts-details">
        <h3>Schichten des Mitarbeiters</h3>
        <div *ngIf="shifts.length > 0; else noShifts" class="shifts-list">
          <div *ngFor="let shift of shifts" class="shift-item">
            <div class="shift-time">
              <span>Start: {{ shift.shiftStart | date:'medium' }}</span>
              <span>Ende: {{ shift.shiftEnd | date:'medium' }}</span>
            </div>
            <div *ngIf="shift.breakStart" class="break-time">
              <span>Pause Start: {{ shift.breakStart | date:'medium' }}</span>
              <span>Pause Ende: {{ shift.breakEnd | date:'medium' }}</span>
            </div>
          </div>
        </div>
        <ng-template #noShifts>
          <p>Keine Schichten gefunden.</p>
        </ng-template>
      </section>
    </main>
  </div>
</div>
